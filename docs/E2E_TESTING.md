# ç«¯åˆ°ç«¯æµ‹è¯•æŒ‡å—

## ç³»ç»ŸçŠ¶æ€æ€»ç»“

### âœ… å·²å®Œæ•´å®ç°çš„ç»„ä»¶

1. **Chatbotå¯¹è¯ç³»ç»Ÿ** - åŸºäºLangGraph + MOSESæœ¬ä½“
2. **åå°ä»»åŠ¡ç®¡ç†** - æŒä¹…åŒ–ã€å·¥ä½œçº¿ç¨‹ã€æ–‡ä»¶é”
3. **æ–œæ å‘½ä»¤ç³»ç»Ÿ** - 10ä¸ªå‘½ä»¤
4. **éœ€æ±‚æå–** - LLMè‡ªåŠ¨åˆ†æ
5. **Mock RAGæ£€ç´¢** - å…³é”®è¯åŒ¹é… â­ NEW
6. **Generatorç”Ÿæˆ** - ACEæ¡†æ¶
7. **ä¸»åŠ¨æé†’æœºåˆ¶** - AWAITING_CONFIRMè‡ªåŠ¨æç¤º
8. **ç‹¬ç«‹æ£€æŸ¥å·¥å…·** - å¤šç»ˆç«¯ç›‘æ§

### ğŸ”„ ä½¿ç”¨Mockæ•°æ®çš„ç»„ä»¶

- **RAGæ¨¡æ¿æ£€ç´¢** - ä½¿ç”¨ `data/mock/dss_templates.json`ï¼ˆ8ä¸ªDSSå®éªŒæ¨¡æ¿ï¼‰

## ç«¯åˆ°ç«¯æµ‹è¯•æµç¨‹

### å‰ææ¡ä»¶

```bash
# 1. ç¡®ä¿ç¯å¢ƒé…ç½®
source venv/bin/activate
pip install -r requirements.txt

# 2. é…ç½®API Key
cp .env.example .env
# ç¼–è¾‘.envï¼Œå¡«å†™DASHSCOPE_API_KEY

# 3. ç¡®ä¿ç›®å½•å­˜åœ¨
mkdir -p data/playbooks logs/generation_tasks

# 4. ç¡®ä¿playbookå­˜åœ¨
# å¦‚æœæ²¡æœ‰ï¼Œè¿è¡Œä¸€æ¬¡ examples/run_simple_ace.py åˆ›å»ºåˆå§‹playbook
```

### å®Œæ•´æµ‹è¯•è„šæœ¬

#### æµ‹è¯•1ï¼šåŸºç¡€å·¥ä½œæµï¼ˆDSSçƒ­å¤„ç†å®éªŒï¼‰

```bash
# ç»ˆç«¯1ï¼šå¯åŠ¨ä¸»CLI
python examples/workflow_cli.py

# ä»¥ä¸‹æ˜¯äº¤äº’è¿‡ç¨‹
```

**å¯¹è¯è„šæœ¬**ï¼š
```
ğŸ‘¤ ä½ : /help
[æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯]

ğŸ‘¤ ä½ : æˆ‘æƒ³åšDSS 2205çš„å›ºæº¶å¤„ç†å®éªŒ

ğŸ¤– åŠ©æ‰‹: [MOSESæŸ¥è¯¢DSS 2205ç›¸å…³ä¿¡æ¯...]
        åŒç›¸ä¸é”ˆé’¢DSS 2205æ˜¯ä¸€ç§é“ç´ ä½“-å¥¥æ°ä½“åŒç›¸ä¸é”ˆé’¢...

ğŸ‘¤ ä½ : æ¸©åº¦èŒƒå›´1050-1080åº¦ï¼Œéœ€è¦æ°´æ·¬

ğŸ¤– åŠ©æ‰‹: æ˜ç™½äº†ã€‚è¿˜éœ€è¦ç¡®è®¤ï¼š
        - è¯•æ ·å°ºå¯¸å’Œæ•°é‡ï¼Ÿ
        - ä¿æ¸©æ—¶é—´è¦æ±‚ï¼Ÿ
        - æ˜¯å¦éœ€è¦åç»­æ£€æµ‹ï¼Ÿ

ğŸ‘¤ ä½ : è¯•æ ·10mmåšï¼Œä¿æ¸©10åˆ†é’Ÿï¼Œéœ€è¦åšé‡‘ç›¸åˆ†æ

ğŸ¤– åŠ©æ‰‹: å¥½çš„ï¼Œä¿¡æ¯å·²æ”¶é›†ã€‚ä½ å¯ä»¥ä½¿ç”¨ /generate ç”Ÿæˆè¯¦ç»†æ–¹æ¡ˆã€‚

ğŸ‘¤ ä½ : /generate

ğŸš€ å·²æäº¤ç”Ÿæˆä»»åŠ¡ï¼ˆåå°æ‰§è¡Œï¼‰
   ä»»åŠ¡ID: abc12345
   ä½¿ç”¨ /status æŸ¥çœ‹è¿›åº¦
   æ—¥å¿—: logs/generation_tasks/abc12345/task.log

[ç­‰å¾…5-10ç§’ï¼Œç³»ç»Ÿæå–éœ€æ±‚]

======================================================================
â¸ï¸  ä»»åŠ¡éœ€è¦ç¡®è®¤ï¼
======================================================================
  ä»»åŠ¡ID: abc12345
  çŠ¶æ€: awaiting_confirm

ğŸ“‹ éœ€æ±‚å·²æå–ï¼Œæ–‡ä»¶è·¯å¾„:
  logs/generation_tasks/abc12345/requirements.json

ğŸ’¡ æ¥ä¸‹æ¥å¯ä»¥:
  1. æŸ¥çœ‹éœ€æ±‚: cat logs/generation_tasks/abc12345/requirements.json
  2. ä¿®æ”¹éœ€æ±‚: nano logs/generation_tasks/abc12345/requirements.json
  3. ç¡®è®¤ç»§ç»­: /confirm
  4. å–æ¶ˆä»»åŠ¡: /cancel
======================================================================

ğŸ‘¤ ä½ : /status

ä»»åŠ¡çŠ¶æ€: â¸ï¸  AWAITING_CONFIRM
======================================================================
  ä»»åŠ¡ID: abc12345
  ...

ğŸ“ æ•°æ®æ–‡ä»¶:
  âœ… éœ€æ±‚: logs/generation_tasks/abc12345/requirements.json

ğŸ’¡ æ“ä½œæç¤º:
  # æŸ¥çœ‹éœ€æ±‚
  cat logs/generation_tasks/abc12345/requirements.json

  # ç¡®è®¤ç»§ç»­
  /confirm

ğŸ‘¤ ä½ : /confirm

âœ… å·²ç¡®è®¤éœ€æ±‚ï¼Œä»»åŠ¡ç»§ç»­æ‰§è¡Œ...

[ç­‰å¾…10-20ç§’ï¼Œç³»ç»ŸRAGæ£€ç´¢ + Generatorç”Ÿæˆ]

ğŸ‘¤ ä½ : /status

ä»»åŠ¡çŠ¶æ€: âœ… COMPLETED
======================================================================
  ä»»åŠ¡ID: abc12345
  ...

âœ… ä»»åŠ¡å®Œæˆ!
  è€—æ—¶: 15.32s
  Tokens: 4253

ğŸ’¡ æŸ¥çœ‹æ–¹æ¡ˆ:
  cat logs/generation_tasks/abc12345/plan.json
  /view abc12345

ğŸ‘¤ ä½ : /view abc12345

======================================================================
  DSS 2205åŒç›¸ä¸é”ˆé’¢å›ºæº¶å¤„ç†å®éªŒæ–¹æ¡ˆ
======================================================================

## ğŸ“‹ å®éªŒç›®æ ‡
å¯¹DSS 2205åŒç›¸ä¸é”ˆé’¢è¿›è¡Œå›ºæº¶å¤„ç†ï¼Œä¼˜åŒ–ä¸¤ç›¸ç»„ç»‡å¹³è¡¡...

[å®Œæ•´æ–¹æ¡ˆè¾“å‡º]

ğŸ‘¤ ä½ : ä¿æ¸©æ—¶é—´å¯ä»¥å»¶é•¿åˆ°15åˆ†é’Ÿå—ï¼Ÿ

ğŸ¤– åŠ©æ‰‹: å¯ä»¥çš„ã€‚å¯¹äº10mmåšçš„è¯•æ ·ï¼Œå»¶é•¿åˆ°15åˆ†é’Ÿæ›´ä¿é™©...

ğŸ‘¤ ä½ : /quit

ğŸ‘‹ å†è§ï¼ï¼ˆä»»åŠ¡ä¼šç»§ç»­åœ¨åå°è¿è¡Œï¼‰
```

#### æµ‹è¯•2ï¼šå¤šç»ˆç«¯ç›‘æ§

```bash
# ç»ˆç«¯1ï¼šè¿è¡Œä¸»CLIï¼ˆå¦‚ä¸Šï¼‰

# ç»ˆç«¯2ï¼šç‹¬ç«‹ç›‘æ§
python scripts/inspect_tasks.py --list

æ‰€æœ‰ä»»åŠ¡åˆ—è¡¨
======================================================================
  âœ… abc12345 (completed)
     ä¼šè¯: cli_session
     æ—¶é—´: 2025-10-24 15:30:00
     ç›®å½•: logs/generation_tasks/abc12345
     æ–¹æ¡ˆ: DSS 2205åŒç›¸ä¸é”ˆé’¢å›ºæº¶å¤„ç†å®éªŒæ–¹æ¡ˆ

# æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
python scripts/inspect_tasks.py --task abc12345

# æŸ¥çœ‹éœ€æ±‚
python scripts/inspect_tasks.py --requirements abc12345

ğŸ“‹ éœ€æ±‚æ–‡ä»¶: logs/generation_tasks/abc12345/requirements.json
======================================================================
{
  "target_compound": "DSS 2205",
  "objective": "å›ºæº¶å¤„ç†ä¼˜åŒ–ä¸¤ç›¸ç»„ç»‡",
  "constraints": [
    "æ¸©åº¦1050-1080åº¦",
    "æ°´æ·¬å†·å´",
    "ä¿æ¸©10åˆ†é’Ÿ"
  ],
  "special_requirements": "éœ€è¦é‡‘ç›¸åˆ†æ"
}

# æŸ¥çœ‹æ–¹æ¡ˆ
python scripts/inspect_tasks.py --plan abc12345

# æŸ¥çœ‹æ—¥å¿—
python scripts/inspect_tasks.py --log abc12345 --no-follow
```

#### æµ‹è¯•3ï¼šéœ€æ±‚ä¿®æ”¹æµç¨‹

```bash
# ç»ˆç«¯1ï¼šä¸»CLI
ğŸ‘¤ ä½ : æˆ‘è¦æµ‹è¯•DSSçš„è…èš€æ€§èƒ½

ğŸ¤– åŠ©æ‰‹: å¥½çš„ï¼Œè¯·é—®å…·ä½“æ˜¯å“ªç§è…èš€æµ‹è¯•ï¼Ÿ

ğŸ‘¤ ä½ : ç‚¹è…èš€æµ‹è¯•ï¼ŒASTM G61æ ‡å‡†

ğŸ‘¤ ä½ : /generate
[ä»»åŠ¡æäº¤: def45678]

[ç­‰å¾…æé†’]
â¸ï¸  ä»»åŠ¡éœ€è¦ç¡®è®¤ï¼
...

# ç»ˆç«¯2ï¼šæŸ¥çœ‹å¹¶ä¿®æ”¹éœ€æ±‚
cat logs/generation_tasks/def45678/requirements.json

{
  "objective": "DSSç‚¹è…èš€æµ‹è¯•",
  "constraints": ["ASTM G61æ ‡å‡†"],
  ...
}

# æ‰‹åŠ¨æ·»åŠ æ›´å¤šçº¦æŸ
vim logs/generation_tasks/def45678/requirements.json

{
  "objective": "DSSç‚¹è…èš€æµ‹è¯•",
  "constraints": [
    "ASTM G61æ ‡å‡†",
    "6% FeCl3æº¶æ¶²",        # æ·»åŠ 
    "æ¸©åº¦èŒƒå›´20-60åº¦",      # æ·»åŠ 
    "å¹³è¡Œæ ·å“3ä¸ª"           # æ·»åŠ 
  ],
  ...
}

# ä¿å­˜åå›åˆ°ç»ˆç«¯1
ğŸ‘¤ ä½ : /confirm
âœ… å·²ç¡®è®¤éœ€æ±‚ï¼Œä»»åŠ¡ç»§ç»­æ‰§è¡Œ...

[ç³»ç»Ÿä¼šä½¿ç”¨ä¿®æ”¹åçš„éœ€æ±‚ç»§ç»­ç”Ÿæˆ]
```

#### æµ‹è¯•4ï¼šCLIé€€å‡ºåä»»åŠ¡ç»§ç»­

```bash
# ç»ˆç«¯1
ğŸ‘¤ ä½ : /generate
[ä»»åŠ¡æäº¤: ghi78901]

[åœ¨EXTRACTINGçŠ¶æ€æ—¶æŒ‰Ctrl+C]
^C
ğŸ‘‹ ç¨‹åºè¢«ä¸­æ–­ï¼Œæ­£åœ¨é€€å‡º...
   ä»»åŠ¡ä¼šç»§ç»­åœ¨åå°è¿è¡Œ

# ç»ˆç«¯2ï¼šéªŒè¯ä»»åŠ¡ä»åœ¨è¿è¡Œ
python scripts/inspect_tasks.py --watch ghi78901

ğŸ‘€ å®æ—¶ç›‘æ§ä»»åŠ¡ ghi78901 (Ctrl+C é€€å‡º)

[14:35:10] çŠ¶æ€å˜æ›´: extracting
[14:35:15] çŠ¶æ€å˜æ›´: awaiting_confirm

# é‡æ–°å¯åŠ¨CLI
python examples/workflow_cli.py

[TaskManager] Workerå·²åœ¨å…¶ä»–è¿›ç¨‹è¿è¡Œï¼Œè·³è¿‡å¯åŠ¨

ğŸ‘¤ ä½ : /status
ä»»åŠ¡çŠ¶æ€: â¸ï¸  AWAITING_CONFIRM
...

ğŸ‘¤ ä½ : /confirm
[ç»§ç»­å®Œæˆä»»åŠ¡]
```

### éªŒè¯Mock RAGæ˜¯å¦å·¥ä½œ

æŸ¥çœ‹ä»»åŠ¡æ—¥å¿—ï¼š
```bash
cat logs/generation_tasks/<task_id>/task.log

# åº”è¯¥çœ‹åˆ°ï¼š
[HH:MM:SS] STEP 3: RAGæ£€ç´¢æ¨¡æ¿
[HH:MM:SS] [MockRAG] åŠ è½½äº† 8 ä¸ªæ¨¡æ¿
[HH:MM:SS] [MockRAG] æå–å…³é”®è¯: ['å›ºæº¶å¤„ç†', 'dss 2205', ...]
[HH:MM:SS] [MockRAG] æ£€ç´¢åˆ° 3 ä¸ªç›¸å…³æ¨¡æ¿:
[HH:MM:SS]   1. DSS 2205åŒç›¸ä¸é”ˆé’¢å›ºæº¶å¤„ç†å·¥è‰º
[HH:MM:SS]   2. DSSæ˜¾å¾®ç»„ç»‡é‡‘ç›¸åˆ†æ
[HH:MM:SS]   3. DSSçƒ­å˜å½¢å®éªŒï¼ˆGleebleæ¨¡æ‹Ÿï¼‰
[HH:MM:SS] æ£€ç´¢åˆ° 3 ä¸ªæ¨¡æ¿ï¼ˆä½¿ç”¨Mock RAGï¼‰
```

æŸ¥çœ‹æ£€ç´¢ç»“æœï¼š
```bash
cat logs/generation_tasks/<task_id>/templates.json

# åº”è¯¥åŒ…å«3ä¸ªå®Œæ•´çš„æ¨¡æ¿æ•°æ®
```

## Mock RAGæµ‹è¯•ç”¨ä¾‹

### ç”¨ä¾‹1ï¼šå›ºæº¶å¤„ç†

**è¾“å…¥éœ€æ±‚**ï¼š
```json
{
  "objective": "DSS 2205å›ºæº¶å¤„ç†",
  "target_compound": "DSS 2205"
}
```

**é¢„æœŸåŒ¹é…æ¨¡æ¿**ï¼š
- DSS 2205åŒç›¸ä¸é”ˆé’¢å›ºæº¶å¤„ç†å·¥è‰ºï¼ˆé«˜åˆ†ï¼‰
- DSSçƒ­å˜å½¢å®éªŒï¼ˆä¸­åˆ†ï¼‰
- DSSæ˜¾å¾®ç»„ç»‡é‡‘ç›¸åˆ†æï¼ˆä½åˆ†ï¼‰

### ç”¨ä¾‹2ï¼šè…èš€æµ‹è¯•

**è¾“å…¥éœ€æ±‚**ï¼š
```json
{
  "objective": "ç‚¹è…èš€æµ‹è¯•",
  "constraints": ["ASTM G61"]
}
```

**é¢„æœŸåŒ¹é…æ¨¡æ¿**ï¼š
- DSSç‚¹è…èš€ç”µä½æµ‹è¯•ï¼ˆASTM G61ï¼‰ï¼ˆé«˜åˆ†ï¼‰
- DSSåº”åŠ›è…èš€å¼€è£‚æµ‹è¯•ï¼ˆä¸­åˆ†ï¼‰
- DSSæ™¶é—´è…èš€æ•æ„Ÿæ€§è¯„ä»·ï¼ˆä¸­åˆ†ï¼‰

### ç”¨ä¾‹3ï¼šé‡‘ç›¸åˆ†æ

**è¾“å…¥éœ€æ±‚**ï¼š
```json
{
  "objective": "é‡‘ç›¸åˆ†æ",
  "special_requirements": "ç›¸æ¯”ä¾‹æµ‹é‡"
}
```

**é¢„æœŸåŒ¹é…æ¨¡æ¿**ï¼š
- DSSæ˜¾å¾®ç»„ç»‡é‡‘ç›¸åˆ†æï¼ˆé«˜åˆ†ï¼‰
- DSS 2205åŒç›¸ä¸é”ˆé’¢å›ºæº¶å¤„ç†å·¥è‰ºï¼ˆä½åˆ†ï¼‰

## é¢„æœŸè¾“å‡ºæ–‡ä»¶ç»“æ„

```
logs/generation_tasks/<task_id>/
â”œâ”€â”€ task.json
â”‚   {
â”‚     "task_id": "abc12345",
â”‚     "status": "completed",
â”‚     "has_requirements": true,
â”‚     "has_templates": true,
â”‚     "has_plan": true,
â”‚     ...
â”‚   }
â”‚
â”œâ”€â”€ requirements.json
â”‚   {
â”‚     "target_compound": "DSS 2205",
â”‚     "objective": "å›ºæº¶å¤„ç†ä¼˜åŒ–ä¸¤ç›¸ç»„ç»‡",
â”‚     "constraints": [...],
â”‚     ...
â”‚   }
â”‚
â”œâ”€â”€ templates.json
â”‚   [
â”‚     {
â”‚       "title": "DSS 2205åŒç›¸ä¸é”ˆé’¢å›ºæº¶å¤„ç†å·¥è‰º",
â”‚       "procedure_summary": "...",
â”‚       "key_points": [...],
â”‚       ...
â”‚     },
â”‚     {...},
â”‚     {...}
â”‚   ]
â”‚
â”œâ”€â”€ plan.json
â”‚   {
â”‚     "title": "DSS 2205åŒç›¸ä¸é”ˆé’¢å›ºæº¶å¤„ç†å®éªŒæ–¹æ¡ˆ",
â”‚     "objective": "...",
â”‚     "materials": [...],
â”‚     "procedure": [...],
â”‚     "safety_notes": [...],
â”‚     ...
â”‚   }
â”‚
â””â”€â”€ task.log
    [14:30:00] Task abc12345 started
    [14:30:01] STEP 1: æå–éœ€æ±‚
    ...
    [14:30:25] Task abc12345 finished
```

## æ•…éšœæ’æŸ¥

### Mock RAGæœªå·¥ä½œ

**ç—‡çŠ¶**ï¼šæ—¥å¿—æ˜¾ç¤º "æ£€ç´¢åˆ° 0 ä¸ªæ¨¡æ¿"

**æ’æŸ¥**ï¼š
```bash
# 1. æ£€æŸ¥mockæ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -l data/mock/dss_templates.json

# 2. æ£€æŸ¥æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
cat logs/generation_tasks/<task_id>/task.log | grep "Mock RAG"

# 3. æ‰‹åŠ¨æµ‹è¯•mock_rag
python
>>> from workflow.mock_rag import create_mock_rag_retriever
>>> rag = create_mock_rag_retriever()
>>> templates = rag.retrieve({"objective": "å›ºæº¶å¤„ç†"})
>>> len(templates)
3
```

### Generatorä½¿ç”¨äº†ç©ºæ¨¡æ¿

**ç—‡çŠ¶**ï¼šç”Ÿæˆçš„æ–¹æ¡ˆæ²¡æœ‰å‚è€ƒæ¨¡æ¿å†…å®¹

**åŸå› **ï¼šè¿™æ˜¯æ­£å¸¸çš„ï¼Generatorä¼šï¼š
1. ä¼˜å…ˆä½¿ç”¨playbook bulletsï¼ˆACEæ¡†æ¶ï¼‰
2. å‚è€ƒtemplatesä½œä¸ºè¾…åŠ©
3. å³ä½¿templatesä¸ºç©ºä¹Ÿèƒ½ç”Ÿæˆ

**éªŒè¯**ï¼šæŸ¥çœ‹ç”Ÿæˆçš„æ–¹æ¡ˆæ˜¯å¦åˆç†ï¼Œæ˜¯å¦ä½¿ç”¨äº†playbookæŒ‡å¯¼

## ä¸‹ä¸€æ­¥ï¼šçœŸå®RAGå®ç°

Mock RAGéªŒè¯é€šè¿‡åï¼Œå¯ä»¥å®ç°çœŸå®RAGï¼š

1. **é€‰æ‹©å‘é‡æ•°æ®åº“**ï¼šChroma / Faiss / Milvus
2. **å®ç°æ–‡æ¡£å¤„ç†**ï¼šåˆ‡åˆ†ã€åµŒå…¥ã€ç´¢å¼•
3. **å®ç°æ£€ç´¢é€»è¾‘**ï¼šè¯­ä¹‰æœç´¢ + é‡æ’åº
4. **æ›¿æ¢mock_rag**ï¼šåœ¨command_handler.pyä¸­æ›¿æ¢å¯¼å…¥

å‚è€ƒé…ç½®æ–‡ä»¶ï¼š`configs/rag_config.yaml`ï¼ˆå·²å­˜åœ¨ï¼‰

## æ€»ç»“

âœ… **ç³»ç»Ÿå·²å®Œå…¨å¯ç”¨**ï¼Œé™¤äº†RAGä½¿ç”¨Mockæ•°æ®å¤–ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½æ˜¯çœŸå®å®ç°

âœ… **å¯ä»¥ç«¯åˆ°ç«¯æµ‹è¯•**ï¼Œä»å¯¹è¯åˆ°ç”Ÿæˆå®Œæ•´æµç¨‹

âœ… **Mockæ•°æ®å……è¶³**ï¼Œ8ä¸ªDSSå®éªŒæ¨¡æ¿è¦†ç›–ä¸»è¦åœºæ™¯

âœ… **æ˜“äºæ›¿æ¢**ï¼ŒçœŸå®RAGå®ç°ååªéœ€ä¿®æ”¹ä¸€è¡Œå¯¼å…¥å³å¯

**å¼€å§‹æµ‹è¯•å§ï¼** ğŸš€
